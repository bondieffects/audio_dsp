# ============================================================================
# Simplified Timing Constraints for I2S Audio Pass-Through System
# Device: EP4CE6E22C8N
# Author: Group 10
# ============================================================================

# ============================================================================
# Clock Constraints
# ============================================================================

# Primary 50MHz system clock
create_clock -name {clk_50mhz} -period 20.000 -waveform {0.000 10.000} [get_ports {clk_50mhz}]

# PLL-generated 12.288MHz audio master clock
# This is generated by the PLL from the 50MHz input
create_generated_clock -name {i2s_mclk} \
    -source [get_pins {u_audio_pll|altpll_component|auto_generated|pll1|inclk[0]}] \
    -multiply_by 73 -divide_by 297 \
    [get_pins {u_audio_pll|altpll_component|auto_generated|pll1|clk[0]}]

# ============================================================================
# Clock Groups (Define asynchronous clock domains)
# ============================================================================

# System clock and audio clock are related through PLL but treat as separate domains
set_clock_groups -asynchronous \
    -group [get_clocks {clk_50mhz}] \
    -group [get_clocks {i2s_mclk}]

# ============================================================================
# Input Constraints
# ============================================================================

# Reset input constraint (asynchronous)
set_false_path -from [get_ports {reset_n}]

# I2S data input from WM8731 ADC
# Data is valid on rising edge of BCLK, with setup/hold requirements
set_input_delay -clock {i2s_mclk} -max 15.0 [get_ports {i2s_din}]
set_input_delay -clock {i2s_mclk} -min 5.0 [get_ports {i2s_din}]

# ============================================================================
# Output Constraints
# ============================================================================

# I2S clock outputs to WM8731
set_output_delay -clock {i2s_mclk} -max 10.0 [get_ports {i2s_mclk}]
set_output_delay -clock {i2s_mclk} -min 2.0 [get_ports {i2s_mclk}]

set_output_delay -clock {i2s_mclk} -max 10.0 [get_ports {i2s_bclk}]
set_output_delay -clock {i2s_mclk} -min 2.0 [get_ports {i2s_bclk}]

set_output_delay -clock {i2s_mclk} -max 10.0 [get_ports {i2s_ws}]
set_output_delay -clock {i2s_mclk} -min 2.0 [get_ports {i2s_ws}]

# I2S data output to WM8731 DAC
# Data must be stable on falling edge of BCLK
set_output_delay -clock {i2s_mclk} -max 10.0 [get_ports {i2s_dout}]
set_output_delay -clock {i2s_mclk} -min 2.0 [get_ports {i2s_dout}]

# LED outputs (not timing critical)
set_false_path -to [get_ports {led[*]}]

# Test point outputs (not timing critical)
set_false_path -to [get_ports {test_point_1}]
set_false_path -to [get_ports {test_point_2}]

# ============================================================================
# Timing Analysis Settings
# ============================================================================

# Enable timing analysis for all paths
derive_pll_clocks
derive_clock_uncertainty

# ============================================================================
# End of Constraints File
# ============================================================================
